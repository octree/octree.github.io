---
layout: post
date: 2017-05-20
title: 关于火掌柜 App 架构方向的思考
disqus: y
---

前言

2017.5.19 日，又看了一遍黄金三镖客，直至次日凌晨 2 点才看完了这部经典的西部片。夜深人静时候的单身狗总是容易胡思乱想。所以作为一个入睡前喜欢思考一点东西的单手狗，在今天悄悄地对火掌柜 App 伸出了罪恶的双手。当然，也付出了沉痛的代价。想到了掌柜客户端的架构以及未来的优化，对于火掌柜 App 的思考让我辗转反侧，直到凌晨三点，也毫无睡意。于是打开电脑，在昏暗的显示屏下，记录下来自己的想法。



思考



由于火掌柜的架构目前还是有点混乱的，所以，在不需要付出任何代价的前提下，我假设如果让我重新设计整个 App，我会怎么架构。



当然，我并不会直接去思考怎么直接去撸代码，具体的代码实现不属于架构的一部分。首先是对于掌柜业务的梳理。因为火掌柜是一个 To B 的项目，是商家使用的 App，或者说是面向企业的 App，它的作用就是便于各位老板大爷管理自己的企业。对于管理企业，我们首先从企业的结构入手。一个企业，需要划分哪些部门，分别管理，它们的职能是什么？

以我浅薄的认识和一点点人生的经验，我们企业可能会需要一下几个职能部门：

1. 研发部：负责产品的研发
2. 人事部：负责员工的管理
3. 销售：负责产品的销售
4. 行政部：
5. 运营：
6. 财务：



以上几个职能部门，都可以在我们掌柜 App 中找到对应的功能：



1. 研发部：掌柜 App 中 ⌈商品与套餐⌋ 功能
2. 人事部：掌柜 App 中 ⌈员工管理⌋ 功能
3. 销售：
4. 行政部：掌柜 App 中 ⌈分公司⌋、⌈连锁⌋ 等功能
5. 运营：掌柜 App 中 ⌈会员⌋、⌈公众号营销⌋、⌈体检⌋ 、⌈优惠券⌋  等功能，这些都是火掌柜为企业提供的运营手段。
6. 财务：掌柜 App 中 ⌈银行卡⌋ 等功能，以及提供的财务数据分析的功能。



整个掌柜 App 的功能都能对应现实企业中的一个职能部门，而项目架构和现实生活中的架构本质是相同的。都是为了分离职能，让各个部门专注于自己的职能，提高整体效率。从现实生活中借鉴，对掌柜 App 的业务进行分离，尽可能的降低业务之间的耦合度。



通过对业务的模块的划分，目前我们也只能实现模块化开发，就像一台计算机一样，我们可以分离出 CPU、内存、硬盘等分别制造，但是要让整个计算机运行起来，还是要把 CPU、内存、硬盘等组合起来。这些东西缺一不可。还不能实现组件化的开发。什么叫组件开发，个人认为就是即插即用，你添加这个组件，系统就有了这个功能，你不添加，系统也能完整运行，只是缺少了你这个组件的功能，叫好比鼠标、打印机之于计算机。



在深入火掌柜之前，我开了一个小差，想到了滴滴打车的组件化开发，滴滴把 App 分成打出租车、叫快车等几个组件，每个组件都可以独立于行，组件与组件之间没有耦合。需要发版的时候只需要把需要的组件添加到主工程，就组成了滴滴打车 App。就算你少加一个组件，也不会影响其他功能的运行。



那么，火掌柜 App 能像滴滴打车一样实现组件化开发么？



首先，看商品与套餐功能：

商品与套餐，商家可以在 App 中管理自己的商品，添加套餐。整个功能相对比较基础，基本不以来其他的组件，可以独立运行。我们暂且认为它可以作为一个组件来进行开发。



优惠券：

火掌柜的优惠券功能，是针对商品的。也可以说，优惠券整个功能十分依赖商品与套餐功能。那么也就是说，离开了商品与套餐功能，优惠券是不能独立运行的。也就是说优惠券和商品不能分离，两个功能之间是有耦合的，不能拆分成两个组件。如果要实现组件化开发，它们两个注定是要在一起的。



会员：

又是一个悲伤的故事，火掌柜中的会员模块是有依赖优惠券项目的，同理，这个组件家庭中又迎来了一个新的成员，会员系统，组成了一个快乐的三口之家。



公众号营销：

这个模块也是依赖了优惠券项目的，还好国家开放了二孩政策，家族中已经有四位成员了。这个家庭在慢慢变大，一个组件开始变得像一个 App 一样庞大。



掌柜中的很多功能这里就不一一列举、逐个分析了。最后分析出来，有 80% 的业务相互之间是有依赖的，是相互离不开的。



为了减少各个组件的耦合度，通过模块化，然后模块间开放接口给其他的模块使用。甚至为了进一步减少耦合度，通过[CTMediator](https://casatwy.com/iOS-Modulization.html), 进一步分离，看起来似乎没什么耦合，其实，一旦你依赖了另一个模块，就算你通过再多的中间人去访问另一个模块，你这个模块也不可能独立运行，修炼成组件。



所以，我最后得出的结论就是，掌柜 App 的组件化开发是没必要的，也是难以实现的。也只能达到模块化开发的程度，这些应该算是由掌柜的业务导致的局限性。



当然还有一种解释，就是我的能力的问题。当然我相信大牛们有更好的解决方案，这里写下来自己对于掌柜架构方向的一些思考，如果能有人提出更好的方案，能够传授给我一点经验，那坠吼的。



最后

已经思考了掌柜 App 的组件化开发，并得出了一个不怎么乐观的结论。但，项目的优化还是要继续，那么退而求其次，要怎么把业务进行拆分，尽可能的减少模块之间的耦合度，进行模块化开发，这是个问题，请等待单身狗下一个无眠的夜晚。


